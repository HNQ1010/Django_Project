<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <meta charset="UTF-8">
    <title>SCATTER</title>
</head>
<body>
<h1 style="color:blue; text-align:center">SCATTER PLOTS</h1>
    <ul>
        <h2 style = "color: blue">Scatter Plot with Plotly Express Figure</h2>
        <p style="color:blue">Attributes list:</p>
        <ul>
            <li><b>data_frame</b>: DataFrame or array-like or dict. If missing, a DataFrame gets constructed under the hood using the other arguments.</li>
            <li><b>x</b>: (str or int or Series or array-like) This value is used to position marks along the x axis in cartesian coordinates.</li>
            <li><b>y</b>: (str or int or Series or array-like) This value is used to position marks along the y axis</li>
            <li><b>color</b>: (str or int or Series or array-like) This value is used to assign color to marks.</li>
            <li><b>symbol</b>: (str or int or Series or array-like)  This value is used to assign symbols to marks.</li>
            <li><b>size</b>: (str or int or Series or array-like) This value is used to assign mark sizes.</li>
            <li><b>hover_name</b>: (str or int or Series or array-like) This value appears in bold in the hover tooltip.</li>
            <li><b>hover_data</b>: <b style="color:red">(list</b> of str or int, or Series or array-like, or dict) If values is True(default formatting), False(in order<br>
                to remove this column from hover information), or a formatting string, or list-like data to appear in the hover tooltip or tuples with a bool<br>
                or formatting string as first element, and list-like data in the hover tooltip.</li>
            <li><b>custom_data</b>: <b style="color:red">(list</b> of str or int, or Series or array-like) Values from these columns are extra data, to be used in widgets<br>
                or Dash callbacks. This data is not user-visible but is included in events emitted by the figure (lasso selection, etc...)</li>
            <li><b>text</b>: (str or int or Series or array-like) Values from this column or array-like appear in the figure as text labels.</li>
            <li><b>facet_row</b>: (str or int or Series or array-like) Values from this column or array-like are used to assign marks to faceted subplots in the vertical direction.</li>
            <li><b>facet_col</b>: (str or int or Series or array-like) Values from this column or array-like are used to assign marks to faceted subplots in the horizontal direction.</li>
            <li><b>facet_col_wrap(int)</b>: Maximum number of facet columns. Wraps the column variable at this width, so that the column facets span multiple rows.<br>
                Ignored if 0, and forced to 0 if facet_row or a marginal is set.</li>
            <li><b>facet_row_spacing(float between 0 and 1)</b>: Spacing between facet rows, in paper units. Default is 0.03 or 0.0.7 when facet_col_wrap is used.</li>
            <li><b>facet_col_spacing(float between 0 and 1)</b>: Spacing between facet columns, in paper units. Default is 0.02</li>
            <li><b>error_x</b>: (str or int or series or array-like) Values from this column or array-like are used </li>
            <li><b>error_x_minus</b>: (str or int or Series or array-like) Value from this column or array-like are used to size x-axis error bar in teh negative direction.<br>
            Ignore if error_x is None</li>
            <li><b>error_y</b>: (str or int or Series or array-like) Values from this column or array-like are used to size y-axis error bars. If error_y_minus is None<br>
                error bars will be symmetrical, otherwise error_y is used for the positive direction only.</li>
            <li><b>error_y_minus</b>: (str or int or Series or array-like) Values from this column or array-like are used to size y-axs error bars in the negative direction.<br>
                Ignored if error_y is None.</li>
            <li><b>animation_frame</b>: (str or int or Series or array-like) Values from this column or array-like are used to assign marks to animation frames.</li>
            <li><b>animation_group</b>: (str or int or Series or array-like) Values from this column or array-like are used to provide object-constancy across animation <br>
                frames: rows with matching animation group will be treated as if they describe the same object in each frame.</li>
            <li><b>category_orders</b>: (dict with str keys and list with str values) Default {}. This parameter us used to force a specific ordering of values per column.<br>
                The keys of this dict should correspond to column names, and the values should be lists of strings corresponding to the specific display order desired.</li>
            <li><b>labels</b>: (dict with str keys and str values) Default {}. This parameter allows overridden, the keys of this dict should correspond to column names,<br>
                and the values should correspond to the desired label to be displayed.</li>
            <li><b>orientation</b>: (str, one of 'h' for horizontal or 'v' for vertical) Default 'v' if x and y are provided and both continuous or both categorical, <br>
                otherwise 'v' ('h') if x(y) is categorical and y(x) is continuous, otherwise 'v'('h') if only x(y) is provided.</li>
            <li><b>color_discrete_sequence(list of str)</b>: String should define valid CSS-colors. When color is set and the values in the corresponding <br>
                column are not numeric, values in that column are assigned colors by cycling though color_discrete_sequence in the order described in category_orders<br>
                , unless the value of color is a key in color_discrete_map. Various useful color sequences are available in the plotly.express.colors submodules(plotly.express.colors.qualitative).</li>
            <li><b>color_continuous_scale(list of str)</b>: String should define valid CSS-colors. This list is used to build a continuous color scale when the column <br>
                denoted by color contains numeric data.(see plotly.express.color.sequential, plotly.express.colors.diverging, plotly.express.colors.cyclical).</li>
            <p style="color:red">In case using method for str or numeric data, you should using transfer method to redefine the type of column data. See examples:</p>
            <pre>
                df["size"] = df["size"].astype(str) #convert to string
                df["size"] = df["size"].astype(float) #convert back to numeric
            </pre>
            <li><b>range_color (list of two numbers)</b>: If provided, overrides auto-scaling on the continuous color scale.</li>
            <li><b>color_continuous_midpoint( number)</b>: Default None. If set, computes the bounds of the continuous color scale to have the desired midpoint.<br>
                <b style="color:red">Setting this value is recommended when using color_continuous_scale.</b></li>
            <li><b>symbol_sequence(list of str)</b>: String should define valid plotly.js symbols. When symbol is set, values in that column are assigned symbols<br>
                by cycling through symbol_sequence in the order described in category_orders, unless the value of symbol is a key in symbol_map.</li>
            <li><b>symbol_map(dict with str keys and str values)</b>: Default {}. String values should define plotly.js symbols. Used to override symbol_sequence<br>
                to assign a specific symbols to marks corresponding with specific values. Key in symbol_map should be values in the column denoted by symbol.<br>
                Alternatively, if the values of symbol are valid symbol names, the string 'identity' may be passed to cause them to be used directly.</li>
            <li><b>opacity(float)</b> : value between 0 and 1. Sets the opacity for markers.</li>
            <li><b>size_max(int)</b> : Default 20. Set the maximum mark size when using size.</li>
            <li><b>marginal_x(str)</b> : Options: 'rug', 'box', 'violin', 'histogram'. If set, a horizontal subplot is drawn to the right of the main plot, visualizing the x-distribution.</li>
            <li><b>marginal_y(str)</b> : Options: 'rug', 'box', 'violin', 'histogram'. If set, a vertical subplot is drawn to the above of the main plot, visualizing the y-distribution.</li>
            <li><b>trendline (str)</b> : Options: 'ols', 'lowess', 'rolling', 'expanding', 'ewn'.</li>
                <ul>
                    <li><b>ols</b> :An ordinary Least Squares regression line will be drawn for each discrete-color/ symbol group.</li>
                    <li><b>lowess</b> :A Locally Weighted Scatterplot Smoothing line will be drawn for each discrete-color/ symbol group.</li>
                    <li><b>rolling</b> :A Rolling (average, median) line will be drawn for each discrete-color/ symbol group.</li>
                    <li><b>expanding</b> :An Expanding (average, sum) line will be drawn for each discrete-color/ symbol group.</li>
                    <li><b>ewm</b> :An Exponentially Weighted Moment (exponetially-weighted moving average) line will be drawn for each discrete-color/ symbol group.</li>
                </ul>
            <li><b>trendline_options(dict)</b> : Options passed as the first argument to the function in the trendline argument.</li>
            <li><b>trendline_scope(str)</b> :Options: trace , overall. Default trace. If trace, trendline is drawn per trace, if overall trendline is compute for <br>
                the entire dataset, an replicated across all facets.</li>
            <li><b>log_x(boolean)</b> : Default False. If True, the x-axis is log-scaled in cartesian coordinates.</li>
            <li><b>log_y(boolean)</b> : Default False. If True, teh y-axis is log-scaled in cartesian coordinates.</li>
            <li><b>range_x(list of two numbers)</b> : If provided, override auto-scaling on the x-axis in cartesian coordinates.</li>
            <li><b>range_y(list of two numbers)</b> : If provided, override auto-scaling on the y-axis in cartesian coordinates. </li>
            <li><b>render_mode(str)</b> : Options: 'auto', 'svg', 'webgl'. Default 'auto'. Controls the browser API used to draw marks. 'svg' is appropriate for figures <br>
                of less than 1000 data points, and will allow for fully-vectorized output. 'webgl' is likely necessary for acceptable performance above 1000 points<br>
                but rasterizes part of the output. 'auto' uses heuristics to choose the mode.</li>
            <li><b>title(str)</b> : the figure title.</li>
            <li><b>template(str or dict or go.layout.Template instance)</b>: The figure template name (must be a key in plotly.io.templates) or define.</li>
            <li><b>width(int)</b> : Default None. The figure width in pixels.</li>
            <li><b>height(int)</b> : Default None. The figure height in pixels.</li>
        </ul>

        <h2 style = "color: blue">Scatter Plot with Plotly Express</h2>
        <li>Plotly Express library uses data in it's py files.</li>
        <li>Use these commands to explore its files.</li>
            <pre>
                import plotly.express as px
                print(px.data.__file__)
                Out[]:c:\users\thanh phat us\appdata\local\programs\python\python39\lib\site-packages\plotly\express\data\__init__.py

                for name in dir(px.data):
                    if not '__' in name:
                        print(i)
                Out[]:
                absolute_import
                carshare
                election
                election_geojson
                experiment
                gapminder
                iris
                medals_long
                medals_wide
                stocks
                tips
                wind
            </pre>
        <li>Probably all of them (except absolute_import) are functions which reads some .gz file with data.</li>
            <pre>
            # These are pandas DataFrame
                print(px.data.carshare())
                print(px.data.election())
                print(px.data.gapminder())
                print(px.data.iris())
                print(px.data.tips())
                print(px.data.wind())
            </pre>
        <li>With px scatter, each data point is represented as a marker point, whose location is given by the x and y columns.</li>
        <pre>
            # x and y given as array_like objects
            import plotly.express as px
            fig = px.scatter(x=[0, 1, 2, 3, 4], y = [0, 1, 4, 9, 16])
            fig.show()
        </pre>
        <img src="{% static 'IMG/newplot.png'%}">
        <pre>
            # x and y given as DataFrame columns
            import plotly.express as px
            import pandas as pd
            import numpy as np
            df = px.data.iris()     # iris() is a DataFrame of Pandas. (iris.data file)
            fig = px.scatter(df, x ='sepal_width', y = 'sepal_length')
            fig.show()
        </pre>
        <img src="{% static 'IMG/scatter_2.png'%}" alt="my image">
        <h2 style = "color: blue">Setting Size and Color With Column Name</h2>
        <li>Scatter plots with variable-sized circular makers are ofter known as <b>bubble chart</b>.</li>
        <li>Note that color and size data are added to hover information.</li>
        <li>You can add other columns to hover data with the hover_data argument of px.scatter.</li>
        <li>Note that values of hover data must be in the list.</li>
        <li>Hover data: get the label of data inside or outside the chart.</li>
        <pre>
            import plotly.express as px
            import pandas as pd
            import numpy as np
            df = px.data.iris()
            px.scatter(df, x = 'sepal_width', y = 'sepal_length', color ='species', size ='petal_length', hover_data =['petal_width'])
            fig.show()
        </pre>
        <li>Color can be <b>continuous</b> as follow, or as <b>dicrete/ categorical</b> as above.</li>
        <pre>
            df = px.data.iris()
            fig = px.scatter(df, x ='sepal_with', y='sepal_length', color ='petal_length')
        </pre>
        <img src="{% static 'IMG/scatter_3.png'%}">
        <li>The symbol argument can be mapped to a column as well.</li>
        <pre>
            fig = px.scatter(df, x ='sepal_width', y = 'sepal_length', color = 'species', symbol = 'species')
            fig.show()
        </pre>
        <img src="{% static 'IMG/scatter_4.png'%}">
        <h2 style = "color: blue">Scatter Plot in Dash</h2>
        <li>Dash is the best way to build analytical apps in Python using Plotly figures.</li>
        <pre>
            import pandas as pd
            import dash
            from dash import dcc #(dash_core_components)
            from dash import html #(html_components)
            from dash import Input, Output
            import plotly.express as px

            df = pd.data.iris()
            app = dash.Dash(__name__)
            app.layout = html.Div(  [dcc.Graph(id = 'scatter-plot'),
                                    html.P('Petal Width:'),
                                    dcc.RangeSlider(id = 'range-slider,
                                                    min = 0, max = 2.5, step = 0,1,
                                                    marks = {0 : '0', 2.5 : '2.5'},
                                                    value = [0.5, 2]),])
            @app.callback(  Output('scatter-plot', 'figure',
                            [Input('range-slider', 'value')])
            def update_bar_chart(slider_range):
                low, high = slider_range
                mask = (df['petal_width'] >low) & (df['petal_width'] < high)
                fig = px.scatter(df[mask], x = 'sepal_width', y = 'sepal_length', color='species', size = 'petal_length',
                                    hover_data = ['petal_width'])
                return fig
            app.run_server(debug = True)
        </pre>
            <img src="{% static 'IMG/scatter_6.png'%}">
        <h2 style = "color: blue">Scatter Plots and Categorical Axes</h2>
        <li>Scatter plots can be made on using any type of cartesian axis, including linear, logarithmic, categorical or date axes.</li>
        <li>Scatter plots where one axis is categorical are often known as dot plots.</li>
            <pre>
                df = px.data.medals_long()
                fig = px.scatter(df, x = 'count', y = 'nation', color='medal', symbol = 'medal')
                fig.show()
            </pre>
            <img src="{% static 'IMG/scatter_5.png'%}">
        <h2 style = "color: blue">Error Bar</h2>
        <li>Scatter plots support error bar (offset of value).</li>
            <pre>
                df = px.data.iris()
                df['e'] = df['sepal_width']/100
                fig = px.scatter(df, x = 'sepal_width', y ='sepal_length', color='species',error_x = 'e', error_y ='e')
                fig.show()
            </pre>
            <img src="{% static 'IMG/scatter_7.png'%}">
        <h2 style = "color: blue">Marginal Distribution Plots (sub-chart outside charts)</h2>
            <pre>
                df = px.data.iris()
                fig = px.scatter(x = 'sepal_width', y = 'sepal_length', marginal_x = 'histogram', marginal_y ='rug')
                fig.show()
            </pre>
            <img src="{% static 'IMG/scatter_8.png'%}">
        <h2 style = "color: blue">Facetting  : divides data into parts of category.</h2>
            <pre>
                df = px.data.tips()
                fig = px.scatter(df, x = 'total_bill', y = 'tip', color = 'smoker', facet_col = 'sex', facet_row = 'time')
                fig.show()
            </pre>
            <img src="{% static 'IMG/scatter_9.png'%}">
        <h2 style = "color: blue">Linear Regression and Other Trendlines.</h2>
        <li style="color:red">Before using trendline attribute, check <b>import statsmodels.api</b>, if not, install statsmodels package: <b>pip install statsmodels</b></li>
            <pre>
                fig = px.scatter(df, x ='total_bill', y ='tip', trendline = 'ols')
                fig.show()
            </pre>
            <img src="{% static 'IMG/scatter_10.png'%}">
        <h2 style = "color: blue">Line Plots with Plotly Express.</h2>
            <pre>
                t = np.linspace(2, 2*np.pi, 100)
                fig = px.line(x =t, y = np.cos(t), labels= {'x': 't', 'y' :'cos(t)'})
                fig.show()
            </pre>
            <img src="{%static 'IMG/line_1.png'%}">
            <pre>
                df = px.data.gapminder().query("continent == 'Oceania'") # (or df = px.data.gapminder(), df[df['continent'] == 'Oceania']
                fig = px.line(df, x = 'year', y = 'lifeExp', color = 'country')
                fig.show()
            </pre>
            <img src="{% static 'IMG/line_2.png'%}">
        <li>The markers and the symbol argument can be set to show on lines.</li>
            <pre>
                fig = px.line(df, x = 'year', y = 'lifeExp', color = 'country', markers = True, symbol = 'country')
                fig.show()
            </pre>
            <img src="{% static 'IMG/line_3.png'%}">
        <h2 style = "color: blue">Line Plots on Date Axes</h2>
        <li>Line plots can be  made on using any type of cartesian axis, including linear, logarithmic, categorical or date axes.<br>
            Line plots on date axes are often called <b>time-series chart.</b></li>
        <li>Plotly auto-sets the axis type to a date format when the corresponding data are either ISO-formatted date strings, date pandas or numpy.</li>
            <pre>
                df = px.data.stocks()
                fig = px.line(df, x = 'date', y = 'GOOG')
                fig.show()
            </pre>
            <img src="{% static 'IMG/line_4.png'%}">
        <h2 style = "color: blue">Data Order in Scatter and Line Charts</h2>
        <li>Plotly line charts are implemented as <b>connected scatterplots</b>, meaning that the points are plotted and connected with lines in the order they're provided, without auto-reorder.</li>
        <li>This makes it possible to make charts, but may be required to explicitly sort data before passing it to Plotly to avoid lines moving 'backwards' across the chart.</li>
            <pre>
                df = pd.DataFrame({'x': [1,3,2,4],
                                    'y': [1,2,3,4]})
                fig = px.line(df, x = 'x', y = 'y', title = 'Unsorted Input')
                fig.show()
                df_1 = df.sort_values(by = 'x')
                fig_1 = px.line(df_1, x= 'x', y = 'y', title = 'Sorted Input')
                fig_1.show()
            </pre>
            <img src="{% static 'IMG/line_5.png'%}">
            <img src="{% static 'IMG/line_6.png'%}">
        <h2 style = "color: blue">Connected Scatterplots</h2>
        <li>In a connected scatterplot, two continuous variables are plotted against each other, with a line connecting them in some meaningful order,<br>
            usually a time variable.</li>
        <li>If <b>hover_data</b> parameter using list to get data from other columns and implicitly indicates in the graph, <b>text</b> parameter directly indicates the other column values in graph.</li>
            <pre>
                df = px.data.gapminder().query("country in ['Canada', 'Botswana']")
                fig = px.pne(df, x = 'lifeExp', y = 'gdpPercap', color = 'country', text = 'year')
                fig.update_traces(textposition = 'bottom right') # put text position to bottom instead of inline.
                fig.show()
            </pre>
            <img src="{% static 'IMG/line_7.png'%}">
        <h2 style = "color: blue">Scatter and Line Plots With go.Scatter (plotly.graph_objects)</h2>
        <li>If Plotly express does not provide a good starting point, it is possible to use the more generic <b>go.Scatter</b> class from plotly.graph_objects.</li>
        <li>Whereas plotly.express has two functions scatter and line, go.Scatter can be used both for plotting points (makers) or lines, depending on the value of mode.</li>
        <pre>
            import plotly.graph_objects as go
            import numpy as np
            N = 1000
            t = np.linspace(0, 10, 100)
            y = np.sin(t)
            fig = go.Figure(data = go.Scatter(x = t, y = y, mode = 'markers'))
            fig.show()
        </pre>
            <img src="{% static 'IMG/go_1.png'%}">
        <h2 style = "color: blue">Line and Scatter Plots</h2>
        <li>Use mode argument to choose between markers, lines, or a combination of both.</li>
        <pre>
            np.random.seed(1)
            N = 100
            random_x = np.linsapce(0, 1, N)
            random_y0 = np.random.randn(N) + 5
            random_y1 = np.random.randn(N)
            random_y2 = np.random.randn(N) -5

            fig = go.Figure()
            # Add traces
            fig.add_traces(go.Scatter(x = random_x, y = random_y0, mode = 'markers', name = 'markers')
            fig.add_traces(go.Scatter(x = random_x, y = random_y1, mode = 'lines + markers', name = 'lines + markers')
            fig.add_traces(go.Scatter(x = random_x, y = random_y2, mode = 'lines', name = 'lines')
            fig.show()
        </pre>
        <img src="{% static 'IMG/go_2.png'%}">
        <h2 style = "color: blue">Bubble Scatter Plots</h2>
        <li>In <b>bubble chart</b>, a third party dimension of the data is shown through the size of markers.</li>
        <pre>
            fig = go.Figure(data = go.Scatter(x = [1, 2, 3, 4], y = [10, 11, 12, 13], mode = 'markers',
                                                marker = {'size' : [40, 60, 80, 100], # marker = dict(size = [40, 60, 80, 100]
                                                            'color' : [0, 1, 2, 3]})) #                 color = [0, 1, 2,3]
            fig.show()
        </pre>
        <img src="{% static 'IMG/go_3.png'%}">
        <h2 style = "color: blue">Style Scatter Plots</h2>
        <pre>
            t = np.linspace(0, 10, 100)
            fig = go.Figure()
            fig.add_traces(go.Scatter(x = t, y = np.sin(t), mode = 'markers', name = 'sin(t), marker_color = 'rgba(152, 0, 0, .8)', name = 'First Trace'))
            fig.add_traces(go.Scatter(x = t, y = np.cos(t), mode = 'markers', name = 'cos(t), marker_color = 'rgba(255, 182, 193, .9)', name = 'Second Trace'))
            # Set options common to all traces with fig.update_traces
            fig.update_traces(mode = 'markers', marker_line_width = 2, marker_size = 10)
            fig.update_layout(title = 'Style Scatter', yaxis_zeroline = False, xaxis_zeroline = False)
            fig.show()
        </pre>
        <img src="{% static 'IMG/go_4.png'%}">
        <h2 style = "color: blue">Data Label on Hover</h2>
        <pre>
            data = pd.read('titanic.txt')
            fig = go.Figure(data = go.Scatter(x = data['Cabin'], y = data['Age'], mode = 'markers', marker_color = data['Age'], text = ['Name']))
            fig.update_layout(title = 'Age and Cabin')
            fig.show()
        </pre>
        <img src="{% static 'IMG/go_5.png'%}">
        <h2 style = "color: blue">Scatter With a Color Dimension</h2>
        <pre>
            fig = go.Figure(data = go.Scatter(  y = np.random.rand(500), mode = 'markers',
                                                marker = {  'size' : 16,
                                                            'color' = np.random.rand(500),  # set color equal to variable
                                                            'colorscale' : 'Viridis'},      # one of plotly colorscale
                                                            'showscale' : True))
            fig.show()
        </pre>
        <img src="{% static 'IMG/go_6.png'%}">
        <h2 style = "color: blue">Large Data Sets</h2>
        <li>Now in Plotly you can implement WebGL with Scattergl() in place of Scatter() for increased speed, improved interactivity, and the ability to plot even more data!</li>
        <pre>
            N = 10000
            fig = go.Figure(data = go.Scattergl(x = np.random.randn(N), y= np.random.randn(N),
                                                mode = 'markers', marker = {'color':np.random.randn(N),
                                                                            'colorscale' : 'Viridis',
                                                                            'showscale' : True,
                                                                            'line_width' : 1}))
            fig.show()
        </pre>
        <img src="{% static 'IMG/go_7.png'%}">
        <h2 style = "color: blue">What About Dash</h2>
        <li>Dash is open-source framework for building analytical applications, with no Javascript required, and it is tightly integrated with the Plotly library.</li>
        <li>Everywhere in the page, you can display the same figure (fig.show()) in a Dash application by passing it to the figure argument of the Graph component <br>
        from the built-in DASH_CORE_COMPONENTS (dcc) package.</li>
        <pre>
            import plotly.graph_object as go
            fig = go.Figure()
            ...

            import dash
            from dash import dcc
            from dash import html

            app = dash.Dash()
            app.layout = html.Div([dcc.Graph(figure = fig)])
            app.run_server(debug = True, use_reloader = False) # Turn off reloader if inside Jupyter
        </pre>
    </ul>
</body>
</html>